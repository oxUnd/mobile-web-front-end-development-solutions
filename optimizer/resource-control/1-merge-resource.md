### 资源合并

> 根据不完全统计，移动端页面请求的时候请求的资源个数越少越好

**越少**，看来我们的目的是要把资源合并的“越少”，大家可能发现了我在这里加了引号，可能都猜到了，这个**越少**也是有玄机的。

一般一个复杂的web应用有好几个页面，每个页面的展示元素不尽相同，这样它们使用的css、js代码都是不一样的，这样如果为了达到越少，把它们全都合并，是不太理想的做法。所以，为了达到**越少**，很容易想到的办法就是按照页面合并。

![图一](../images/dir.png)


上图展示了一下，一个前端FIS项目的[目录规范]()，关于它的细节可以参见[fis-plus]()解决方案，如果你开发的是移动端的应用需要选用她。从上图可以看出，我们渲染的目标`home/page/index.tpl`扩展了`layout.tpl`，而`layout.tpl`又使用了两个组件`header`、`footer`。

那么，我们的目标是针对于`index.tpl`这个页面进行打包，那打包结果是；

- `common_index.pkg.js` 合并`common`模块被`index.tpl`引用的静态资源
- `home_index.pkg.js` 合并`home`模块被`index.tpl`引用的静态资源

FIS项目中，跨模块的静态资源使用是不被允许的，具体原因参见[文档]()，所以同种资源（js、css、image）我们最少能合并成两个包。

现在考虑一个新的情况，假设`home`模块还有另外一个页面`B.tpl`，而恰巧使用的资源跟`index.tpl`有重复的（重合的资源是`home`模块下的）。如果还是按照上面的合并方式，就会导致某些资源同时被多处合并的情况。这样的结果导致这些资源无法使用`缓存`，`index.tpl`和`B.tpl`无法共享`缓存`。

虽然目标**页面请求资源数量达到最小**依然达到，但是静态资源无法**共享缓存**，所以这样合并方案是不合理的。

所以在FIS里面同一个资源是无法合并入两个包的，除非你使用黑魔法，直接内嵌！

这样，合并的结果如下；

```javascript
fis.config.set('pack', {
    '/static/home_common_pkg.js': 'com**.js',
    '/static/home_index_pkg.js': 'index**.js',
    '/static/home_B_pkg.js': 'B**.js'
});
```

> FIS中，可以在项目配置文件（默认是`fis-conf.js`）里面用`fis.config.set('pack', {});`来配置打包策略。

原则是**越少**，但多出来了至少一个包，也就是多了一个请求；不过别担心，我们在[缓存使用](./cache-use.md)章节彻底解决请求多的问题。

那么本节就到末尾了，需要总结一下；

- 本节讲述了，如何使用FIS进行打包
- 了解了FIS项目的目录规范
- 打包规则是尽量减少请求
- 打包时考虑重点页面